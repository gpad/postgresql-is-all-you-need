{"version": 2, "width": 225, "height": 54, "timestamp": 1732978333, "idle_time_limit": 1.0, "env": {"SHELL": "/bin/bash", "TERM": "xterm-256color"}}
[0.004624, "o", "\u001b[?1049h\u001b[22;0;0t\u001b[?1h\u001b=\u001b[H\u001b[2J\u001b[?12l\u001b[?25h\u001b[?1000l\u001b[?1002l\u001b[?1003l\u001b[?1006l\u001b[?1005l\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[?1006l\u001b[?1000l\u001b[?1002l\u001b[?1003l\u001b[?2004l\u001b[1;1H\u001b[1;54r\u001b[>c\u001b[>q\u001b[39;124H\u001b[?2004h"]
[0.00598, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[1;112H\u001b[1K\u001b[Hexample=# \u001b[2;112H\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\u001b[1;114Hexample=# \u001b[K\u001b[2;114H\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[2Bexample=# \u001b[K\u001b[21;114H\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[2Bexample=# \u001b[K\u001b[40;114H\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[30m\u001b[42m\r\n[0] 0:psql*                                                                                                                                                                                              \"tardis\" 15:52 30-nov-24\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[39;124H\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[?1006l\u001b[?1000l\u001b[?1002l\u001b[?1003l\u001b[?2004l\u001b[1;1H\u001b[1;54r\u001b[39;124H\u001b[?2004h"]
[0.007205, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[1;112H\u001b[1K\u001b[Hexample=# \u001b[2;112H\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\u001b[1;114Hexample=# \u001b[K\u001b[2;114H\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[2Bexample=# \u001b[K\u001b[21;114H\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[2Bexample=# \u001b[K\u001b[40;114H\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[30m\u001b[42m\r\n[0] 0:psql*                                                                                                                                                                                              \"tardis\" 15:52 30-nov-24\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[39;124H"]
[0.007539, "o", "\u001b[?7727h"]
[3.133926, "o", "\u001b[?25l\u001b[1;113H\u001b[32m│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H\u001b[32m│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[32m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[1;11H"]
[4.581706, "o", "\u001b[7mDROP TABLE IF EXISTS executed_tasks;\u001b[3;1HCREATE TABLE executed_tasks (\r\n        id uuid NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),\r\n        \"name\" text NOT NULL,\r\n        start_at timestamp NOT NULL,\r\n  completed_at timestamp NOT NULL\r\n);\r\n\u001b(B\u001b[m"]
[6.089256, "o", "\u001b[1;11HDROP TABLE IF EXISTS executed_tasks;\u001b[3;1HCREATE TABLE executed_tasks (\r\n        id uuid NOT NULL PRIMARY KEY DEFAULT gen_random_uuid(),\r\n        \"name\" text NOT NULL,\r\n        start_at timestamp NOT NULL,\r\n  completed_at timestamp NOT NULL\r\n);\r\n\u001b[?2004l"]
[6.089525, "o", "NOTICE:  table \"executed_tasks\" does not exist, skipping\r\nDROP TABLE\r\n"]
[6.10993, "o", "CREATE TABLE\r\nexample=# \u001b[?2004h"]
[18.36213, "o", "\u001b[7mTRUNCATE executed_tasks RESTART IDENTITY;\r\n\u001b(B\u001b[m"]
[19.106922, "o", "\u001b[12;11HTRUNCATE executed_tasks RESTART IDENTITY;\r\n\u001b[?2004l"]
[19.124122, "o", "TRUNCATE TABLE\r\nexample=# \u001b[?2004h"]
[24.687352, "o", "\u001b[7mINSERT INTO executed_tasks (\"name\", start_at, completed_at) \r\n  VALUES('other-tasks', '2021-01-01', '2021-01-01');\r\nINSERT INTO executed_tasks (\"name\", start_at, completed_at) \r\n  VALUES('good_morning', now() - INTERVAL '65 minutes', now() - INTERVAL '62 minutes');\r\n\u001b(B\u001b[m"]
[25.904663, "o", "\u001b[14;11HINSERT INTO executed_tasks (\"name\", start_at, completed_at) \r\n  VALUES('other-tasks', '2021-01-01', '2021-01-01');\r\nINSERT INTO executed_tasks (\"name\", start_at, completed_at) \r\n  VALUES('good_morning', now() - INTERVAL '65 minutes', now() - INTERVAL '62 minutes');\r\n\u001b[?2004l"]
[25.908189, "o", "INSERT 0 1\r\n"]
[25.909846, "o", "INSERT 0 1\r\nexample=# \u001b[?2004h"]
[29.835827, "o", "\u001b[7mSELECT * FROM executed_tasks et ;\r\n\u001b(B\u001b[m"]
[30.774182, "o", "\u001b[20;11HSELECT * FROM executed_tasks et ;\r\n\u001b[?2004l"]
[30.774431, "o", "                  id                  |     name     |          start_at          |        completed_at        \r\n--------------------------------------+--------------+----------------------------+----------------------------\r\n c52ae92b-7b9c-4d22-8fff-9737225cd005 | other-tasks  | 2021-01-01 00:00:00        | 2021-01-01 00:00:00\r\n 86e150d0-96c6-4eec-a48c-4291429ef870 | good_morning | 2024-11-30 13:47:39.228006 | 2024-11-30 13:50:39.228006\r\n(2 rows)\u001b[27;1H\u001b[?2004hexample=# "]
[38.160928, "o", "\u001b[7mSELECT hashtext('cronjob'), hashtext('good_morning');\r\n\u001b(B\u001b[m"]
[39.132269, "o", "\u001b[27;11HSELECT hashtext('cronjob'), hashtext('good_morning');\r\n\u001b[?2004l"]
[39.13266, "o", " hashtext  | hashtext  \r\n-----------+-----------\r\n 380994472 | 474900263\r\n(1 row)\u001b[33;1Hexample=# \u001b[?2004h"]
[45.701957, "o", "\u001b[7mSELECT \r\n  pg_try_advisory_xact_lock(hashtext('cronjob'), hashtext('good_morning'))::boolean as lock_taken,\r\n  now() - COALESCE((SELECT max(completed_at) FROM       executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n;\r\n\u001b(B\u001b[m"]
[46.915848, "o", "\u001b[33;11HSELECT \r\n  pg_try_advisory_xact_lock(hashtext('cronjob'), hashtext('good_morning'))::boolean as lock_taken,\r\n  now() - COALESCE((SELECT max(completed_at) FROM       executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n;\r\n\u001b[?2004l"]
[46.916717, "o", " lock_taken |     elapsed     \r\n------------+-----------------\r\n t          | 01:02:21.007702\r\n(1 row)\u001b[43;1Hexample=# \u001b[?2004h"]
[49.715386, "o", "\u001b[7mSELECT \r\n  pg_try_advisory_xact_lock(hashtext('cronjob'), hashtext('good_morning'))::boolean as lock_taken,\r\n  now() - COALESCE((SELECT max(completed_at) FROM       executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n;\r\n\u001b(B\u001b[m"]
[50.646448, "o", "\u001b[43;11HSELECT \r\n  pg_try_advisory_xact_lock(hashtext('cronjob'), hashtext('good_morning'))::boolean as lock_taken,\r\n  now() - COALESCE((SELECT max(completed_at) FROM       executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n;\r\n\u001b[?2004l"]
[50.646836, "o", " lock_taken |    elapsed     \r\n------------+----------------\r\n t          | 01:02:24.73829\r\n(1 row)\u001b[53;1Hexample=# \u001b[?2004h"]
[52.675412, "o", "\u001b[1;53r\u001b[2;112H\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\u001b[1d\u001b[1K\u001b[Hexample=# \u001b[1;54r\u001b[1;11H"]
[60.017714, "o", "\u001b[?25l\u001b[30m\u001b[42m\u001b[54;1H[0] 0:psql*                                                                                                                                                                                              \"tardis\" 15:53 30-nov-24\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[1;11H"]
[63.734265, "o", "\u001b[7mDO\r\n$do$\r\nDECLARE\r\n  result RECORD;\r\n  start_at timestamp;\r\nBEGIN\r\n  start_at = CLOCK_TIMESTAMP();\r\n  SELECT \r\n    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\r\n    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n    INTO result;\r\n  RAISE NOTICE 'Result: %', result;\r\n  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\r\n    RAISE NOTICE 'Lock taken, waiting 10 sec';\r\n    PERFORM pg_sleep(10);\r\n    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\r\n());\r\n  ELSE\r\n    RAISE NOTICE 'Unable to execute task %', result;\r\n  END IF;\r\nEND\r\n$do$;\r\n\u001b(B\u001b[m"]
[66.352657, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[39;124H"]
[68.951469, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[39m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[20;124H"]
[70.226379, "o", "\u001b[?25l\u001b[1;113H\u001b[32m│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H\u001b[39m│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[1;124H"]
[71.341871, "o", "[200~DO\u0007\u001b[2;114H\u001b[?2004l"]
[71.341918, "o", "example-# $do$\u001b[3;114Hexample$# DECLARE\u001b[4;114Hexample$# \u001b[?2004h  result RECORD;\u001b[5;114Hexample$#   start_at timestamp;\u001b[6;114H\u001b[?2004lexample$# \u001b[?2004h"]
[71.342052, "o", "BEGIN\u001b[7;114Hexample$# "]
[71.342087, "o", "  start_at = CLOCK_TIMESTAMP();\u001b[8;114Hexample$#   SELECT \u001b[9;114H\u001b[?2004l\u001b[?2004hexample$# "]
[71.342219, "o", "    pg_try_advisory_xact_lock(hashtext('cronjob'),"]
[71.342359, "o", "hashtext('good_morning'))::boolean as lock_taken,\u001b[10;114H\u001b[?2004lexample$# \u001b[?2004h"]
[71.342465, "o", "    now() - COALESCE((SELECT max(completed_at) FROM"]
[71.342631, "o", "executed_tasks WHERE name = 'good_morning'), '2000-\u001b[11;114H01-01') as elapsed\u001b[12;114H\u001b[?2004l\u001b[?2004h"]
[71.342678, "o", "example$# "]
[71.342728, "o", "    INTO result;\u001b[13;114H\u001b[?2004lexample$# \u001b[?2004h"]
[71.342787, "o", "  RAISE NOTICE 'Result: %', result;\u001b[14;114H\u001b[?2004l\u001b[?2004h"]
[71.342833, "o", "example$# "]
[71.34293, "o", "  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[15;114H\u001b[?2004l\u001b[?2004h"]
[71.342976, "o", "example$# "]
[71.343042, "o", "    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[16;114H\u001b[?2004l\u001b[?2004h"]
[71.343086, "o", "example$# "]
[71.343132, "o", "    PERFORM pg_sleep(10);\u001b[17;114H\u001b[?2004l\u001b[?2004hexample$# "]
[71.343386, "o", "\u001b[?25l\u001b[1;114Hexample-# $do$\u001b[K\u001b[2;114Hexample$# DECLARE\u001b[K\u001b[3;114Hexample$#   result RECORD;\u001b[K\u001b[4;114Hexample$#   start_at timestamp;\u001b[K\u001b[5;114Hexample$# BEGIN\u001b[K\u001b[6;114Hexample$#   start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[7;114Hexample$#   SELECT \u001b[K\u001b[8;114Hexample$#     pg_try_advisory_xact_lock(hashtext('cronjob'),hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[9;114Hexample$#     now() - COALESCE((SELECT max(completed_at) FROMexecuted_tasks WHERE name = 'good_morning'), '2000-\u001b[10;114H01-01') as elapsed\u001b[K\u001b[11;114Hexample$#     INTO result;\u001b[K\u001b[12;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[13;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[14;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[15;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[16;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[17;114H_TIMESTAMP());\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?2004l"]
[71.34341, "o", "\u001b[?25l\u001b[1dexample$# DECLARE\u001b[K\u001b[2;114Hexample$#   result RECORD;\u001b[K\u001b[3;114Hexample$#   start_at timestamp;\u001b[K\u001b[4;114Hexample$# BEGIN\u001b[K\u001b[5;114Hexample$#   start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[6;114Hexample$#   SELECT \u001b[K\u001b[7;114Hexample$#     pg_try_advisory_xact_lock(hashtext('cronjob'),hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[8;114Hexample$#     now() - COALESCE((SELECT max(completed_at) FROMexecuted_tasks WHERE name = 'good_morning'), '2000-\u001b[9;114H01-01') as elapsed\u001b[K\u001b[10;114Hexample$#     INTO result;\u001b[K\u001b[11;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[12;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[13;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[14;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[15;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[16;114H_TIMESTAMP());\u001b[K\u001b[17;114Hexample$#   ELSE\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25hexample$# \u001b[?2004h"]
[71.343533, "o", "\u001b[?25l\u001b[1;114Hexample$#   result RECORD;\u001b[K\u001b[2;114Hexample$#   start_at timestamp;\u001b[K\u001b[3;114Hexample$# BEGIN\u001b[K\u001b[4;114Hexample$#   start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[5;114Hexample$#   SELECT \u001b[K\u001b[6;114Hexample$#     pg_try_advisory_xact_lock(hashtext('cronjob'),hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[7;114Hexample$#     now() - COALESCE((SELECT max(completed_at) FROMexecuted_tasks WHERE name = 'good_morning'), '2000-\u001b[8;114H01-01') as elapsed\u001b[K\u001b[9;114Hexample$#     INTO result;\u001b[K\u001b[10;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[11;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[12;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[13;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[14;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[15;114H_TIMESTAMP());\u001b[K\u001b[16;114Hexample$#   ELSE\u001b[K\u001b[17;114Hexample$#     RAISE NOTICE 'Unable to execute task %', result;\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?2004lexample$# \u001b[?2004h"]
[71.343593, "o", "\u001b[?25l\u001b[1;114Hexample$#   start_at timestamp;\u001b[K\u001b[2;114Hexample$# BEGIN\u001b[K\u001b[3;114Hexample$#   start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[4;114Hexample$#   SELECT \u001b[K\u001b[5;114Hexample$#     pg_try_advisory_xact_lock(hashtext('cronjob'),hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[6;114Hexample$#     now() - COALESCE((SELECT max(completed_at) FROMexecuted_tasks WHERE name = 'good_morning'), '2000-\u001b[7;114H01-01') as elapsed\u001b[K\u001b[8;114Hexample$#     INTO result;\u001b[K\u001b[9;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[10;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[11;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[12;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[13;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[14;114H_TIMESTAMP());\u001b[K\u001b[15;114Hexample$#   ELSE\u001b[K\u001b[16;114Hexample$#     RAISE NOTICE 'Unable to execute task %', result;\u001b[K\u001b[17;114Hexample$#   END IF;\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?2004l"]
[71.343643, "o", "\u001b[?25l\u001b[1dexample$# BEGIN\u001b[K\u001b[2;114Hexample$#   start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[3;114Hexample$#   SELECT \u001b[K\u001b[4;114Hexample$#     pg_try_advisory_xact_lock(hashtext('cronjob'),hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[5;114Hexample$#     now() - COALESCE((SELECT max(completed_at) FROMexecuted_tasks WHERE name = 'good_morning'), '2000-\u001b[6;114H01-01') as elapsed\u001b[K\u001b[7;114Hexample$#     INTO result;\u001b[K\u001b[8;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[9;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[10;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[11;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[12;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[13;114H_TIMESTAMP());\u001b[K\u001b[14;114Hexample$#   ELSE\u001b[K\u001b[15;114Hexample$#     RAISE NOTICE 'Unable to execute task %', result;\u001b[K\u001b[16;114Hexample$#   END IF;\u001b[K\u001b[17;114Hexample$# END\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?2004h"]
[71.343674, "o", "\u001b[?25l\u001b[1dexample$#   start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[2;114Hexample$#   SELECT \u001b[K\u001b[3;114Hexample$#     pg_try_advisory_xact_lock(hashtext('cronjob'),hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[4;114Hexample$#     now() - COALESCE((SELECT max(completed_at) FROMexecuted_tasks WHERE name = 'good_morning'), '2000-\u001b[5;114H01-01') as elapsed\u001b[K\u001b[6;114Hexample$#     INTO result;\u001b[K\u001b[7;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[8;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[9;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[10;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[11;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[12;114H_TIMESTAMP());\u001b[K\u001b[13;114Hexample$#   ELSE\u001b[K\u001b[14;114Hexample$#     RAISE NOTICE 'Unable to execute task %', result;\u001b[K\u001b[15;114Hexample$#   END IF;\u001b[K\u001b[16;114Hexample$# END\u001b[K\u001b[17;114Hexample$# $do$;\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?2004l"]
[71.343896, "o", "\u001b[?25l\u001b[1dexample$#     now() - COALESCE((SELECT max(completed_at) FROMexecuted_tasks WHERE name = 'good_morning'), '2000-\u001b[2;114H01-01') as elapsed\u001b[K\u001b[3;114Hexample$#     INTO result;\u001b[K\u001b[4;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[5;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[6;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[7;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[8;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[9;114H_TIMESTAMP());\u001b[K\u001b[10;114Hexample$#   ELSE\u001b[K\u001b[11;114Hexample$#     RAISE NOTICE 'Unable to execute task %', result;\u001b[K\u001b[12;114Hexample$#   END IF;\u001b[K\u001b[13;114Hexample$# END\u001b[K\u001b[14;114Hexample$# $do$;\u001b[K\u001b[15;114HERROR:  syntax error at or near \"[\"\u001b[K\u001b[16;114HLINE 1: [200~DO\u001b[K\u001b[17;114H        ^\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h"]
[71.344064, "o", "example=# ~\u0007\u001b[?2004h"]
[76.368781, "o", "^C\u001b[13D\u001b[?2004l"]
[76.36887, "o", "\u001b[?25l\u001b[1d01-01') as elapsed\u001b[K\u001b[2;114Hexample$#     INTO result;\u001b[K\u001b[3;114Hexample$#   RAISE NOTICE 'Result: %', result;\u001b[K\u001b[4;114Hexample$#   IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[5;114Hexample$#     RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[6;114Hexample$#     PERFORM pg_sleep(10);\u001b[K\u001b[7;114Hexample$#     INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK\u001b[8;114H_TIMESTAMP());\u001b[K\u001b[9;114Hexample$#   ELSE\u001b[K\u001b[10;114Hexample$#     RAISE NOTICE 'Unable to execute task %', result;\u001b[K\u001b[11;114Hexample$#   END IF;\u001b[K\u001b[12;114Hexample$# END\u001b[K\u001b[13;114Hexample$# $do$;\u001b[K\u001b[14;114HERROR:  syntax error at or near \"[\"\u001b[K\u001b[15;114HLINE 1: [200~DO\u001b[K\u001b[16;114H        ^\u001b[K\u001b[17;114Hexample=# ~^C\u001b[K\u001b[18;114Hexample=# \u001b[K\u001b[?12l\u001b[?25h\u001b[?2004h"]
[77.729152, "o", "\u001b[1;18r\u001b[2;114H\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\n\u001b[K\u001b[1d\u001b[Kexample=# \u001b[1;54r\u001b[1;124H"]
[79.018564, "o", "\u001b[?25l\u001b[10D$do$\u001b[K\u001b[2;114HDECLARE\u001b[K\u001b[3;114H  result RECORD;\u001b[K\u001b[4;114H  start_at timestamp;\u001b[K\u001b[5;114HBEGIN\u001b[K\u001b[7m\u001b[6;114H  start_at = CLOCK_TIMESTAMP();\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[7;114H  SELECT \u001b(B\u001b[m\u001b[K\u001b[7m\u001b[8;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[9;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[10;114H') as elapsed\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[11;114H    INTO result;\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[12;114H  RAISE NOTICE 'Result: %', result;\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[13;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[14;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[15;114H    PERFORM pg_sleep(10);\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[16;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[17;114H());\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[18;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b(B\u001b[m\u001b[K\u001b[?12l\u001b[?25h\u001b[52D"]
[87.716529, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[39m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[20;124H"]
[89.028676, "o", "DO\u001b[21;114H$do$\u001b[22;114HDECLARE\u001b[23;114H  result RECORD;\u001b[24;114H  start_at timestamp;\u001b[25;114HBEGIN\u001b[26;114H\u001b[7m  start_at = CLOCK_TIMESTAMP();\u001b[27;114H  SELECT \u001b[28;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[29;114H\u001b(B\u001b[m"]
[89.028793, "o", "\u001b[?25l\u001b[9A$do$\u001b[K\u001b[21;114HDECLARE\u001b[K\u001b[22;114H  result RECORD;\u001b[K\u001b[23;114H  start_at timestamp;\u001b[K\u001b[24;114HBEGIN\u001b[K\u001b[7m\u001b[25;114H  start_at = CLOCK_TIMESTAMP();\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[26;114H  SELECT \u001b(B\u001b[m\u001b[K\u001b[7m\u001b[27;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[28;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[29;114H') as elapsed\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[30;114H    INTO result;\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[31;114H  RAISE NOTICE 'Result: %', result;\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[32;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[33;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[34;114H    PERFORM pg_sleep(10);\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[35;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[36;114H());\u001b(B\u001b[m\u001b[K\u001b[7m\u001b[37;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b(B\u001b[m\u001b[K\u001b[?12l\u001b[?25h\u001b[52D"]
[91.302936, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[39;124H"]
[96.391471, "o", "\u001b[7mSELECT * FROM executed_tasks et ;\u001b(B\u001b[m"]
[97.212843, "o", "\u001b[33DSELECT * FROM executed_tasks et ;\u001b[40;114H\u001b[?2004l"]
[97.213493, "o", "                  id                  |     name     |          start_at          |        completed_at        \u001b[41;114H--------------------------------------+--------------+----------------------------+----------------------------\u001b[42;114H c52ae92b-7b9c-4d22-8fff-9737225cd005 | other-tasks  | 2021-01-01 00:00:00        | 2021-01-01 00:00:00\u001b[43;114H 86e150d0-96c6-4eec-a48c-4291429ef870 | good_morning | 2024-11-30 13:47:39.228006 | 2024-11-30 13:50:39.228006\u001b[44;114H(2 rows)\u001b[46;114H\u001b[?2004hexample=# "]
[100.446081, "o", "\u001b[?25l\u001b[1;113H\u001b[32m│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H\u001b[32m│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[32m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[24;1H"]
[104.140033, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[46;124H"]
[105.929248, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[39m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[16A"]
[107.44002, "o", "\u001b[12A  start_at = CLOCK_TIMESTAMP();\u001b[26;114H  SELECT \u001b[27;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[28;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[29;114H') as elapsed\u001b[30;114H    INTO result;\u001b[31;114H  RAISE NOTICE 'Result: %', result;\u001b[32;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[33;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[34;114H    PERFORM pg_sleep(10);\u001b[35;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[36;114H());\u001b[37;114H\u001b[?25l\u001b[17ADECLARE\u001b[K\u001b[21;114H  result RECORD;\u001b[K\u001b[22;114H  start_at timestamp;\u001b[K\u001b[23;114HBEGIN\u001b[K\u001b[24;114H  start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[25;114H  SELECT \u001b[K\u001b[26;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[27;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[28;114H') as elapsed\u001b[K\u001b[29;114H    INTO result;\u001b[K\u001b[30;114H  RAISE NOTICE 'Result: %', result;\u001b[K\u001b[31;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[32;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[33;114H    PERFORM pg_sleep(10);\u001b[K\u001b[34;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[35;114H());\u001b[K\u001b[36;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b[K\u001b[37;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?2004l"]
[107.442227, "o", "\u001b[?25l\u001b[17A  result RECORD;\u001b[K\u001b[21;114H  start_at timestamp;\u001b[K\u001b[22;114HBEGIN\u001b[K\u001b[23;114H  start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[24;114H  SELECT \u001b[K\u001b[25;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[26;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[27;114H') as elapsed\u001b[K\u001b[28;114H    INTO result;\u001b[K\u001b[29;114H  RAISE NOTICE 'Result: %', result;\u001b[K\u001b[30;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[31;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[32;114H    PERFORM pg_sleep(10);\u001b[K\u001b[33;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[34;114H());\u001b[K\u001b[35;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b[K\u001b[36;114HNOTICE:  Result: (t,01:03:21.531867)\u001b[K\u001b[37;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?25l\u001b[17A  start_at timestamp;\u001b[K\u001b[21;114HBEGIN\u001b[K\u001b[22;114H  start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[23;114H  SELECT \u001b[K\u001b[24;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[25;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[26;114H') as elapsed\u001b[K\u001b[27;114H    INTO result;\u001b[K\u001b[28;114H  RAISE NOTICE 'Result: %', result;\u001b[K\u001b[29;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[30;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[31;114H    PERFORM pg_sleep(10);\u001b[K\u001b[32;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[33;114H());\u001b[K\u001b[34;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b[K\u001b[35;114HNOTICE:  Result: (t,01:03:21.531867)\u001b[K\u001b[36;114HNOTICE:  Lock taken, waiting 10 sec\u001b[K\u001b[37;114H\u001b[K\u001b[?12l\u001b[?25h"]
[109.713749, "o", "\u001b[?25l\u001b[30m\u001b[42m\u001b[54;1H[0] 0:psql*                                                                                                                                                                                              \"tardis\" 15:54 30-nov-24\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[37;114H"]
[110.163889, "o", "\u001b[?25l\u001b[1;113H\u001b[32m│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H\u001b[39m│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[18d\u001b[?2004h"]
[111.177985, "o", "\u001b[?25l\u001b[1dDECLARE\u001b[K\u001b[2;114H  result RECORD;\u001b[K\u001b[3;114H  start_at timestamp;\u001b[K\u001b[4;114HBEGIN\u001b[K\u001b[5;114H  start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[6;114H  SELECT \u001b[K\u001b[7;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[8;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[9;114H') as elapsed\u001b[K\u001b[10;114H    INTO result;\u001b[K\u001b[11;114H  RAISE NOTICE 'Result: %', result;\u001b[K\u001b[12;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[13;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[14;114H    PERFORM pg_sleep(10);\u001b[K\u001b[15;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[16;114H());\u001b[K\u001b[17;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h\u001b[?2004l"]
[111.17989, "o", "\u001b[?25l\u001b[1d  result RECORD;\u001b[K\u001b[2;114H  start_at timestamp;\u001b[K\u001b[3;114HBEGIN\u001b[K\u001b[4;114H  start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[5;114H  SELECT \u001b[K\u001b[6;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[7;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[8;114H') as elapsed\u001b[K\u001b[9;114H    INTO result;\u001b[K\u001b[10;114H  RAISE NOTICE 'Result: %', result;\u001b[K\u001b[11;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[12;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[13;114H    PERFORM pg_sleep(10);\u001b[K\u001b[14;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[15;114H());\u001b[K\u001b[16;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b[K\u001b[17;114HNOTICE:  Result: (f,01:03:25.269852)\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25h"]
[111.179996, "o", "\u001b[?25l\u001b[1dBEGIN\u001b[K\u001b[2;114H  start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[3;114H  SELECT \u001b[K\u001b[4;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[5;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[6;114H') as elapsed\u001b[K\u001b[7;114H    INTO result;\u001b[K\u001b[8;114H  RAISE NOTICE 'Result: %', result;\u001b[K\u001b[9;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[10;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[11;114H    PERFORM pg_sleep(10);\u001b[K\u001b[12;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[13;114H());\u001b[K\u001b[14;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b[K\u001b[15;114HNOTICE:  Result: (f,01:03:25.269852)\u001b[K\u001b[16;114HNOTICE:  Unable to execute task (f,01:03:25.269852)\u001b[K\u001b[17;114HDO\u001b[K\u001b[18;114H\u001b[K\u001b[?12l\u001b[?25hexample=# \u001b[?2004h"]
[114.81572, "o", "\u001b[?25l\u001b[1;113H\u001b[32m│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H\u001b[32m│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[32m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[24;1H"]
[115.657539, "o", "\u001b[1;11HDO\r\n$do$\r\nDECLARE\r\n  result RECORD;\r\n  start_at timestamp;\r\nBEGIN\r\n  start_at = CLOCK_TIMESTAMP();\r\n  SELECT \r\n    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\r\n    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n    INTO result;\r\n  RAISE NOTICE 'Result: %', result;\r\n  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\r\n    RAISE NOTICE 'Lock taken, waiting 10 sec';\r\n    PERFORM pg_sleep(10);\r\n"]
[115.657639, "o", "    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\r\n());\r\n  ELSE\r\n    RAISE NOTICE 'Unable to execute task %', result;\r\n  END IF;\r\nEND\r\n$do$;\r\n\u001b[?2004l"]
[115.65828, "o", "NOTICE:  Result: (f,01:03:29.749049)\r\n"]
[115.658362, "o", "NOTICE:  Unable to execute task (f,01:03:29.749049)\r\nDO\r\n"]
[115.658434, "o", "example=# \u001b[?2004h"]
[117.453915, "o", "\u001b[?25l\u001b[20;114HBEGIN\u001b[K\u001b[21;114H  start_at = CLOCK_TIMESTAMP();\u001b[K\u001b[22;114H  SELECT \u001b[K\u001b[23;114H    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\u001b[K\u001b[24;114H    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\u001b[25;114H') as elapsed\u001b[K\u001b[26;114H    INTO result;\u001b[K\u001b[27;114H  RAISE NOTICE 'Result: %', result;\u001b[K\u001b[28;114H  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\u001b[K\u001b[29;114H    RAISE NOTICE 'Lock taken, waiting 10 sec';\u001b[K\u001b[30;114H    PERFORM pg_sleep(10);\u001b[K\u001b[31;114H    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\u001b[32;114H());\u001b[K\u001b[33;114H$do$; IF; NOTICE 'Unable to execute task %', result;\u001b[K\u001b[34;114HNOTICE:  Result: (t,01:03:21.531867)\u001b[K\u001b[35;114HNOTICE:  Lock taken, waiting 10 sec\u001b[K\u001b[36;114HDO\u001b[K\u001b[37;114Hexample=# \u001b[K\u001b[?12l\u001b[?25h\u001b[27;11H"]
[117.485995, "o", "DO\r\n$do$\r\nDECLARE\r\n  result RECORD;\r\n  start_at timestamp;\r\nBEGIN\r\n  start_at = CLOCK_TIMESTAMP();\r\n  SELECT \r\n    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\r\n    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n    INTO result;\r\n  RAISE NOTICE 'Result: %', result;\r\n  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\r\n    RAISE NOTICE 'Lock taken, waiting 10 sec';\r\n    PERFORM pg_sleep(10);\r\n    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\r\n());\r\n  ELSE\r\n    RAISE NOTICE 'Unable to execute task %', result;\r\n  END IF;\r\nEND\r\n$do$;"]
[118.404987, "o", "\r\n\u001b[?2004l"]
[118.405597, "o", "NOTICE:  Result: (t,00:00:00.955891)\r\nNOTICE:  Unable to execute task (t,00:00:00.955891)\r\n"]
[118.40568, "o", "DO\r\nexample=# \u001b[?2004h"]
[126.820539, "o", "\u001b[?25l\u001b[1;113H\u001b[32m│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H\u001b[39m│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[18;124H"]
[128.617617, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[39m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[37;124H"]
[129.823703, "o", "\u001b[?25l\u001b[1;113H│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H\u001b[32m├────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[46;124H"]
[130.340578, "o", "SELECT * FROM executed_tasks et ;"]
[131.049973, "o", "\u001b[47;114H\u001b[?2004l"]
[131.050395, "o", "                  id                  |     name     |          start_at          |        completed_at        \u001b[48;114H--------------------------------------+--------------+----------------------------+----------------------------\u001b[49;114H c52ae92b-7b9c-4d22-8fff-9737225cd005 | other-tasks  | 2021-01-01 00:00:00        | 2021-01-01 00:00:00\u001b[50;114H\u001b[?25l\u001b[11A                  id                  |     name     |          start_at          |        completed_at        \u001b[K\u001b[40;114H--------------------------------------+--------------+----------------------------+----------------------------\u001b[K\u001b[41;114H c52ae92b-7b9c-4d22-8fff-9737225cd005 | other-tasks  | 2021-01-01 00:00:00        | 2021-01-01 00:00:00\u001b[K\u001b[42;114H 86e150d0-96c6-4eec-a48c-4291429ef870 | good_morning | 2024-11-30 13:47:39.228006 | 2024-11-30 13:50:39.228006\u001b[K\u001b[43;114H(2 rows)\u001b[K\u001b[44;114H\u001b[K\nexample=# SELECT * FROM executed_tasks et ;\u001b[K\u001b[46;114H                  id                  |     name     |          start_at          |        completed_at        \u001b[K\u001b[47;114H--------------------------------------+--------------+----------------------------+----------------------------\u001b[K\u001b[48;114H c52ae92b-7b9c-4d22-8fff-9737225cd005 | other-tasks  | 2021-01-01 00:00:00        | 2021-01-01 00:00:00\u001b[K\u001b[49;114H 86e150d0-96c6-4eec-a48c-4291429ef870 | good_morning | 2024-11-30 13:47:39.228006 | 2024-11-30 13:50:39.228006\u001b[K\u001b[50;114H 8d7641f9-0c4c-462f-a2cc-25b93499c963 | good_morning | 2024-11-30 14:54:00.760801 | 2024-11-30 14:54:10.769041\u001b[K\u001b[51;114H(3 rows)\u001b[K\u001b[52;114H\u001b[K\n\u001b[K\u001b[?12l\u001b[?25h"]
[131.050499, "o", "example=# \u001b[?2004h"]
[133.885909, "o", "\u001b[?25l\u001b[1;113H\u001b[32m│\u001b[2;113H│\u001b[3;113H│\u001b[4;113H│\u001b[5;113H│\u001b[6;113H│\u001b[7;113H│\u001b[8;113H│\u001b[9;113H│\u001b[10;113H│\u001b[11;113H│\u001b[12;113H│\u001b[13;113H│\u001b[14;113H│\u001b[15;113H│\u001b[16;113H│\u001b[17;113H│\u001b[18;113H│\u001b[19;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[20;113H\u001b[32m│\u001b[21;113H│\u001b[22;113H│\u001b[23;113H│\u001b[24;113H│\u001b[25;113H│\u001b[26;113H│\u001b[27;113H│\u001b[28;113H│\u001b[29;113H│\u001b[30;113H│\u001b[31;113H│\u001b[32;113H│\u001b[33;113H│\u001b[34;113H│\u001b[35;113H│\u001b[36;113H│\u001b[37;113H│\u001b[38;113H├\u001b[39m────────────────────────────────────────────────────────────────────────────────────────────────────────────────\u001b[39;113H\u001b[32m│\u001b[40;113H│\u001b[41;113H│\u001b[42;113H│\u001b[43;113H│\u001b[44;113H│\u001b[45;113H│\u001b[46;113H│\u001b[47;113H│\u001b[48;113H│\u001b[49;113H│\u001b[50;113H│\u001b[51;113H│\u001b[52;113H│\u001b[53;113H│\u001b(B\u001b[m\u001b[?12l\u001b[?25h\u001b[11G"]
[135.365278, "o", "\u001b[1;53r\u001b[2;112H\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\u001b[1d\u001b[1K\u001b[Hexample=# \u001b[1;54r\u001b[1;11H"]
[136.038248, "o", "DO\r\n$do$\r\nDECLARE\r\n  result RECORD;\r\n  start_at timestamp;\r\nBEGIN\r\n  start_at = CLOCK_TIMESTAMP();\r\n  SELECT \r\n    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\r\n    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n    INTO result;\r\n  RAISE NOTICE 'Result: %', result;\r\n  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\r\n    RAISE NOTICE 'Lock taken, waiting 10 sec';\r\n    PERFORM pg_sleep(10);\r\n    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\r\n());\r\n  ELSE\r\n    RAISE NOTICE 'Unable to execute task %', result;\r\n  END IF;\r\nEND\r\n$do$;"]
[137.606628, "o", "\r\n\u001b[?2004l"]
[137.607114, "o", "NOTICE:  Result: (t,00:00:20.157481)\r\nNOTICE:  Unable to execute task (t,00:00:20.157481)\r\nDO\r\n"]
[137.607237, "o", "example=# \u001b[?2004h"]
[144.62968, "o", "DO\r\n$do$\r\nDECLARE\r\n  result RECORD;\r\n  start_at timestamp;\r\nBEGIN\r\n  start_at = CLOCK_TIMESTAMP();\r\n  SELECT \r\n"]
[144.629797, "o", "    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\r\n    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n    INTO result;\r\n  RAISE NOTICE 'Result: %', result;\r\n  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\r\n    RAISE NOTICE 'Lock taken, waiting 10 sec';\r\n    PERFORM pg_sleep(10);\r\n    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\r\n());\r\n  ELSE\r\n    RAISE NOTICE 'Unable to execute task %', result;\r\n  END IF;\r\nEND\r\n$do$;"]
[146.915948, "o", "\r\n\u001b[?2004l"]
[146.916476, "o", "NOTICE:  Result: (t,00:00:29.466758)\r\nNOTICE:  Unable to execute task (t,00:00:29.466758)\r\nDO\r\n"]
[146.916506, "o", "\u001b[?2004hexample=# "]
[148.055366, "o", "\u001b[1;53r\u001b[2;112H\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\n\u001b[1K\u001b[1d\u001b[1K\u001b[Hexample=# \u001b[1;54r\u001b[1;11H"]
[148.708429, "o", "DO\r\n$do$\r\nDECLARE\r\n  result RECORD;\r\n  start_at timestamp;\r\nBEGIN\r\n  start_at = CLOCK_TIMESTAMP();\r\n  SELECT \r\n    pg_try_advisory_xact_lock(hashtext('cronjob'),      hashtext('good_morning'))::boolean as lock_taken,\r\n    now() - COALESCE((SELECT max(completed_at) FROM     executed_tasks WHERE name = 'good_morning'), '2000-01-01\r\n') as elapsed\r\n    INTO result;\r\n  RAISE NOTICE 'Result: %', result;\r\n  IF (result.lock_taken AND result.elapsed > INTERVAL '60 minutes') THEN\r\n    RAISE NOTICE 'Lock taken, waiting 10 sec';\r\n    PERFORM pg_sleep(10);\r\n    INSERT INTO executed_tasks (\"name\", start_at, completed_at) values('good_morning', start_at, CLOCK_TIMESTAMP\r\n());\r\n  ELSE\r\n    RAISE NOTICE 'Unable to execute task %', result;\r\n  END IF;\r\nEND\r\n$do$;"]
[155.378246, "o", "\r\n\u001b[?2004l"]
[155.37873, "o", "NOTICE:  Result: (t,00:00:37.929082)\r\nNOTICE:  Unable to execute task (t,00:00:37.929082)\r\nDO\r\n"]
[155.378767, "o", "\u001b[?2004hexample=# "]
[156.918328, "o", "\u001b[1;54r\u001b(B\u001b[m\u001b[?1l\u001b>\u001b[H\u001b[2J\u001b[?2004l\u001b[?12l\u001b[?25h\u001b[?1000l\u001b[?1002l\u001b[?1003l\u001b[?1006l\u001b[?1005l\u001b[?7727l\u001b[?1004l\u001b[?1049l\u001b[23;0;0t"]
[156.91844, "o", "[detached (from session 0)]\r\n"]
